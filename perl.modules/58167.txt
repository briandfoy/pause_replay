Newsgroups: perl.modules
Path: nntp.perl.org
Xref: nntp.perl.org perl.modules:58167
Return-Path: <michael@insulin-pumpers.org>
Mailing-List: contact modules-help@perl.org; run by ezmlm
Delivered-To: mailing list modules@perl.org
Received: (qmail 8533 invoked from network); 11 Dec 2007 19:26:20 -0000
Received: from x1a.develooper.com (HELO x1.develooper.com) (216.52.237.111)
  by lists.develooper.com with SMTP; 11 Dec 2007 19:26:20 -0000
Received: (qmail 14176 invoked by uid 225); 11 Dec 2007 19:26:20 -0000
Delivered-To: modules@perl.org
Received: (qmail 14171 invoked by alias); 11 Dec 2007 19:26:19 -0000
X-Spam-Status: No, hits=-2.6 required=8.0
	tests=BAYES_00,SPF_PASS
X-Spam-Check-By: la.mx.develooper.com
Received: from ns2.bizsystems.net (HELO ns2.bizsystems.net) (69.3.95.130)
    by la.mx.develooper.com (qpsmtpd/0.28) with ESMTP; Tue, 11 Dec 2007 11:26:07 -0800
Received: from bzs.org (pandora.is.bizsystems.com [192.168.1.190])
	by ns2.bizsystems.net (8.13.4/8.13.4) with ESMTP id lBBJQ38Q027340
	for <modules@perl.org>; Tue, 11 Dec 2007 11:26:03 -0800
Received: from [192.168.1.66] (wannabe.is.bizsystems.com [192.168.1.66])
	by bzs.org (8.11.4/8.11.4) with ESMTP id lBBJQ2K25008
	for <modules@perl.org>; Tue, 11 Dec 2007 11:26:02 -0800
To: modules@perl.org
Date: Tue, 11 Dec 2007 11:25:57 -0800
MIME-Version: 1.0
Subject: Re: $VERSION in Safe compartment
Message-ID: <475E73C5.17462.56EBC13@michael.insulin-pumpers.org>
Priority: normal
In-reply-to: <200712111642.lBBGgQ58013244@ns2.bizsystems.net>
References: <475D47FB.23164.DB7CE7@michael.insulin-pumpers.org>, <200712111642.lBBGgQ58013244@ns2.bizsystems.net>
X-mailer: Pegasus Mail for Windows (4.41)
Content-type: text/plain; charset=US-ASCII
Content-transfer-encoding: 7BIT
Content-description: Mail message body
Approved: news@nntp.perl.org
From: michael@insulin-pumpers.org

> [[ This message was both posted and mailed: see
>    the "To," "Cc," and "Newsgroups" headers for details. ]]
> 
> In article <475D47FB.23164.DB7CE7@michael.insulin-pumpers.org>,
> <michael@insulin-pumpers.org> wrote:
> 
> > One of the modules in a distribution does the following
> > 
> > 
> > $VERSION= do 'something.pm';
> > 
> > where 'something' returns the version string.The indexer does not
> > like this and I'm looking for a work around. 
> 
> Besides John Peacock's comments, if this is a feature you really need,
> look at preprocessing the module files before they show up in blib
> (for instance, using PL_FILES in MakeMaker).
> 
> I'd be curious to hear why you're doing this. :)
> 

In several of the sub-packages of the SpamCannibal distribution most 
of the module is perlxs. There is a companion 'tracking' CTest.pm 
that tests the various pieces and has code that has no reason to be 
in the runtime module which is a 'C' daemon. The perl portion of the 
module only contains:

package Mail::SpamCannibal::DNSBLserver;
use vars qw($VERSION);
$VERSION = do { q|char version[] = "dnsbls 0.47, 3-29-07";
	| =~ /(\d+)\.(\d+)/; sprintf("%d.%02d",$1,$2)};
# returns $VERSION which is non-zero

Makefile.PL parses this module for the $VERSION line and creates the 
'C' header file: c_version.h which contains:

/*      c_version.h
 *
 *      Do not edit this file. It was automatically created by
 *      Makefile.PL and contains the most recent version number
 */
char version[] = "dnsbls 0.47, 3-29-07";

I've used this technique in multiple modules where there is a large 
'C' or perlxs component that must be tested and where the test suite 
and runtime components are very different but must use and track the 
underlying C/perlxs piece.

Since evaluation is allowed in the $VERSION statement it is only 
logical that the sand box the modules are run in at CPAN needs to 
have similar capability. The flip side of that is if you choose not 
to allow it then the docs should state that and ALL of the modules in 
the CPAN library should conform ;-)

Michael
